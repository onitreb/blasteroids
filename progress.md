Original prompt: Build an Asteroids-like 2D web game where the ship attracts small asteroids into a magnet/forcefield radius, they stick to the ship (snowball), and the player can burst them outward; ejected small asteroids break large asteroids into small pieces; small-vs-small annihilates.

Notes
- Keep a single canvas, expose `window.render_game_to_text()` and a deterministic `window.advanceTime(ms)` for Playwright.
- Controls target: rotate + thrust like classic Asteroids; burst on Space or left mouse.

TODO
- Add simple sound effects (optional).

Updates
- Implemented a first playable version (ship movement, magnet ring, attachment, burst, splitting + annihilation, basic HUD, fullscreen toggle).
- Switched to a single non-module JS file so the game can be opened via `file://` (the sandbox disallows binding a local dev server port).
- Playwright validation support is available in this environment; local dependency install is optional.
- Added 3 asteroid sizes (small/med/large), 25% more starting asteroids, elastic-ish collisions, and a velocity-gated fracture rule (fast burst-thrown smalls can fracture med/large and get consumed).
- Small asteroids now stick to the surface of the forcefield ring (half the attraction radius), and the larger attraction circle is a debug toggle in the menu (default on). Ship collision behavior (explode vs bounce) is also a menu toggle.
- Updated attraction to a gravity-well model (stronger when closer), increased attraction radius +5%, increased burst speed +5%, and added simple KISS explosion visuals on burst + collisions. Burst-thrown smalls now self-destruct on impact; they fracture large→2 med and med→2 small (when fast enough).
- Removed the “time window” for fast small impacts: whether a small self-destructs / fractures now depends on current impact speed (velocity-based), and smalls attach to the inner forcefield ring (not the outer attraction radius).
- Clarified visuals + tuning: outer dashed blue ring = gravity radius (debug), inner yellow ring = forcefield surface that smalls stick to; added menu sliders (gravity/burst/capture/damage/fracture) and made ring “capture” forces fade out for high-speed smalls so bursts actually fling outward.
- Added gem drops + scoring: every broken small asteroid spawns a gem (emerald/ruby/diamond at 50%/40%/10%), gems glow and get pulled in/absorbed by the ship for points; score also shown in an HTML HUD overlay.
- Added per-slider “Set default” persistence for tuning via localStorage and added plain-English descriptions under each tuning slider.
- Tweaked gem sizes (green baseline; red ~15% larger; blue ~30% larger) and increased gravity inside the forcefield ring (50% stronger) with extra damping to reduce “slip by” captures.
- Added a debug tuning slider for ship thrust.
- Added a debug tuning slider for inner ring gravity multiplier (how much stronger gravity becomes once inside the forcefield ring).
- Added gem expiration: gems now expire after a tunable lifetime (default 6s) and strobe faster and faster before disappearing (Gem lifetime slider).
- Updated gem expiry visuals: gems now *blink* (no gradual fade) with faster strobing near expiry.
- Tuned gem blinking: no blinking for first half of gem life, then a smooth ramp up to a tunable max blink rate (Gem blink max slider, default 5/s).
- Refactored gem blinking (KISS): blinking now uses an accumulated phase updated in `updateGems` so frequency ramps feel steady (no irregular flicker from time-based modulo with changing frequency).
- Added an occasional blue flying saucer enemy: it spawns offscreen from any edge, glides across without wrapping, fires 2 yellow laser shots toward the ship, and despawns once it exits the playfield.
- Updated saucer behavior pass: doubled saucer size, switched firing to continuous random burst cycles (1-2 shots per burst with ~1-3s pauses), made lasers despawn at the exact canvas edge, and added gentle swerving/lazy flight instead of a rigid straight path.
- Fixed saucer laser visibility regression: beam alpha was tied to removed `ttlSec`, causing effectively invisible shots; refactored to a stable bright yellow beam with stronger core + additive outer glow and verified in-browser screenshot/state.
- Added saucer destruction behavior: asteroid impact destroys saucer, plays yellow explosion/ring FX, removes saucer, awards score, and drops a large yellow/gold gem.
- Refactored gem expiry visuals from hard blink-off to continuous throbbing (bright↔dim) so gems never fully disappear before expiry.
- Strengthened gem pickup feel: larger gem attraction radius, stronger gem gravity + ring capture/funneling, higher in-ring pull, and larger collection radius; gold gem TTL increased to keep it collectible.
- Tightened saucer kill rule: saucer now only dies to ship-launched asteroids (rocks ejected from the player burst), not ambient field rocks.
- Refactored gem gravity/capture math to match the small-asteroid model exactly (same attract radius, gravity, ring capture, radial damping, and inner-ring damping) to remove lurchy behavior.
- Reduced saucer gold-drop size (smaller base radius and lower drop jitter) while keeping the same yellow/gold identity.
- Simplified gem pull again per feedback: gems now ignore shield/ring capture logic entirely and are continuously accelerated directly toward ship center with stronger close-range pull (smooth inverse-square + soft core boost), so they no longer stall at forcefield radius.
- Began large-arena enhancement track: added `state.world` and `state.camera` scaffolding in `src/main.js` (plus `syncCameraToShip()`), with world intentionally still coupled to viewport in this step to avoid gameplay/render behavior changes. Validation: `node --check src/main.js` passes.
- Large-arena LA-02 pass: removed viewport wrapping (`wrapPos`) and added world-bound helpers (`confineShipToWorld`, `confineBodyToWorld`). Ship now clamps/stops at world edge; asteroids and gems now bounce off world edges with damping; saucer/laser bounds now use `state.world`. Validation: `node --check src/main.js` passes. Per user request, browser run is paused until explicitly resumed.
- Large-arena LA-03/LA-04 pass: render pipeline now applies camera offset (`ctx.translate(w/2 - camera.x, h/2 - camera.y)`), and centered camera mode is active via `syncCameraToShip()` each update. Also updated `render_game_to_text` metadata to include `world` and `camera` fields plus corrected coordinate-system description. Validation: `node --check src/main.js` passes; browser run still paused per user request.
- Large-arena LA-05..LA-09 pass: implemented dead-zone camera logic (`camera.mode === "deadzone"`), camera world-clamping, first-pass arena boundary line render, world-aware spawn/despawn bounds, and timed off-screen asteroid replenishment with a dynamic min/target/max population budget (scaled by world/view area and capped by `maxAsteroids`). Validation: `node --check src/main.js` passes; browser run still paused per user request.
- Browser smoke run resumed and completed (DevTools): start/menu flow works, controls respond, ship correctly clamps at world edge, and console shows no errors. Current default camera mode remains `centered`; dead-zone mode exists in code but is not wired to UI/toggle yet.
- Arena behavior update (small step): removed asteroid/gem boundary bounce behavior and switched both to out-of-bounds despawn (`isOutsideWorld(...)`), matching intended design direction. Ship boundary clamp remains unchanged.
- Next small implementation slice: added in-menu arena controls for camera mode (`centered` / `deadzone`) and world size scale (`1x..4x`), with new game-side config hooks (`setArenaConfig`, `applyWorldScale`) so panning can be tested without extra refactors. Kept this step browser-free per user request; validation via `node --check src/main.js`.
- Browser validation of new arena controls (DevTools): selecting `Dead-zone pan` and setting arena scale to `2.00x` updates runtime state (`camera.mode=deadzone`, `world` dimensions doubled). Deterministic movement test confirmed dead-zone behavior (small move keeps camera fixed, longer move causes pan). Switching back to `centered` made camera lock to ship center when not clamped at world edge. Console remained clean.
- LA-10 incremental implementation (terminal-only): added lightweight world cell bookkeeping (`worldCells.sizePx`, `asteroidCounts`, `activeKeys`) rebuilt each tick and used during ambient asteroid spawn to avoid inactive cells and over-dense cells (`cellCount >= 10`). Also exposed cell index stats in `render_game_to_text` under `world_cells`.
- LA-11 incremental implementation (terminal-only): replaced asteroid-vs-asteroid all-pairs loop with a spatial-hash broadphase helper (`forEachNearbyAsteroidPair`) using nearby-cell candidate iteration. Collision resolution logic itself remains the same; only candidate generation changed. Validation: `node --check src/main.js`.
- Browser validation pass for LA-10/LA-11 (DevTools): with `Dead-zone pan` + `2.00x` arena, deterministic movement and long simulation produced no console errors. `render_game_to_text.world_cells` remained consistent (`active_count`/indexed cells nonzero and stable), spawn maintenance continued filling the arena, and collision/burst interactions still behaved correctly (counts and score changed plausibly).
- Added adjustable 3-layer parallax starfield background so movement is readable: new tuning sliders `Star density` and `Parallax strength` (with Set default persistence), background layer rebuild hook, and camera-relative parallax render pass. Added `background` telemetry in `render_game_to_text` (`star_density`, `parallax_strength`, layer count). Browser-validated with low/high parallax screenshots and no console errors.
- Added subtle star accents + twinkle pass: stars now support rare accent colors (gold/red/blue), optional per-star twinkle modulation (alpha + slight radius), and new tuning sliders/default persistence for `Accent star chance`, `Twinkle star chance`, `Twinkle strength`, and `Twinkle speed`. Extended `render_game_to_text.background` telemetry with these values. Validation: `node --check src/main.js` passed. Browser smoke intentionally not run in this step.
- Visual readability follow-up: asteroids are now filled black (opaque interior) so background stars no longer show through rock silhouettes. Twinkle visibility adjusted upward (higher default twinkle chance/strength/speed and stronger modulation range), and twinkle now animates in the menu too (was previously tied to gameplay time only). Validation: `node --check src/main.js` + browser smoke pass (menu + gameplay) with no game-console errors.
- Default tuning/menu tweak: reduced `Twinkle star chance` by 50% (0.36 → 0.18), set default camera mode to `deadzone`, and set default world scale to `3.00x` (menu + runtime defaults aligned). Validation: `node --check src/main.js` + browser reload check of menu values and `render_game_to_text`.
- Arena scale range update: world scale slider now supports up to `10.00x` (was `4.00x`), and arena scale clamping was expanded to `1..10` in runtime config. Validation: `node --check src/main.js` + browser check at `10x` in menu and gameplay (`world` telemetry reached 19600x13050 with no console errors).
- Global spawn authority pass (design-oriented): asteroid replenishment now spawns globally across arena cells (no camera-side spawn bias), startup now bulk-fills toward world-scale target density, and game start guarantees local on-screen asteroid presence (`counts.asteroids_on_screen` telemetry added). Validation at `10x`: immediate gameplay had ~1094 asteroids total, `asteroids_on_screen=13`, and ~915 indexed asteroid cells with no console errors.
- Added debug slider for global spawn density (`Global asteroid density`) wired to `asteroidWorldDensityScale` with live output + Set default persistence. Validation: `node --check src/main.js` plus browser sanity check confirmed min/max/step (`0.08..1.5`, `0.02`) and runtime effect after start.
- Density + spawn-visibility follow-up: increased high-end arena capacity (`maxAsteroids=4000`) and expanded global density slider range to `0.08..2.5`. Runtime replenishment now excludes active camera view when spawning so asteroids do not pop into visible space. Validation at `10x`, density `2.5`: startup had ~2400 asteroids with ~27 on-screen; after simulation total continued climbing (>3000) while on-screen count changed gradually (no pop-in jumps) and console stayed clean.
- Added a new resumable implementation tracker for ship progression and size scaling: `ship-growth-progression-plan.md` (ship tiers at 500/1000 gem points, expanded asteroid sizes, tiered forcefields, in-game debug menu toggle/reorg, and growth-triggered camera zoom plan). This was a planning-only step; no gameplay code changed yet.
- Implemented the ship-growth feature slice in `src/main.js` + `index.html`:
  - Added data-driven ship tiers (`small`, `medium`, `large`) with distinct shapes/engine layouts and size scaling (`1x`, `2x`, `4x`).
  - Added asteroid sizes `xlarge` + `xxlarge`, generalized size fracture graph (`size -> next smaller`), and XL/XXL spawn/radius tuning controls.
  - Added progression unlocks by gem score (`500` / `1000` defaults), tier override controls, and a live gem-score debug slider.
  - Generalized forcefield/attraction to tier rules (small-only, small+med, small+med+large) and tier-scaled radii/colors.
  - Added growth-driven camera zoom state with tweened transitions and debug controls for per-tier zoom targets + duration.
  - Added in-game debug menu open/close while playing (`M` / backquote / top-right button), pause-on-open behavior, apply+resume flow, and grouped 2-column debug/tuning layout.
  - Added runtime ship renderer swap API for future SVG assets: `window.set_ship_svg_renderer(tierKey, svgPathData, scale)`.
- Telemetry updates:
  - `render_game_to_text` now includes progression/tier/zoom metadata and expanded asteroid size counts.
- Validation:
  - `node --check src/main.js` passes.
  - Browser validation for this step was done via DevTools:
    - Verified debug menu opens/closes in active gameplay via button and `KeyM`.
    - Verified pause-on-open toggle (`pausedDelta=0`, `unpausedDelta>0`).
    - Verified tier transitions + zoom tween using gem-score debug slider (`small 1.00 -> medium 0.78 -> large 0.58`).
    - Verified XL/XXL asteroids present in runtime state and no console errors.
- 2026-02-09 maintenance pass: restored projectile size-gating in asteroid collisions (`projectileRank >= targetRank-1`), so launched asteroids only fracture same-size, smaller, or one-size-larger targets (speed gate still required).
- 2026-02-09 cleanup pass: removed local Playwright install artifacts (`node_modules`, npm cache, local package files, ad-hoc Playwright client script) and corrected stale progress notes that claimed Playwright was unavailable.
- 2026-02-10 RF-08 pass (UI extraction):
  - Added `src/ui/createUiBindings.js` and moved browser UI concerns there: menu/tuning bindings, localStorage tuning defaults, HUD updates, and debug toggle/start-or-resume flows.
  - Simplified `src/main.js` into composition glue for engine + renderer + UI plus main loop/input/fullscreen/debug hook exports.
  - Rebuilt bundle via `npm run build`.
  - DevTools `file://` smoke validation passed with no console errors: Start flow, deterministic hooks (`render_game_to_text`, `advanceTime`), movement via scripted `KeyW`, debug menu toggle (`KeyM`/`Escape`), and restart (`KeyR`).
- 2026-02-10 RF-09 pass (public debug/test API stabilization):
  - Added a single `window.Blasteroids` namespace in `src/main.js` with `renderGameToText`, `advanceTime`, and `setShipSvgRenderer`.
  - Kept legacy aliases for compatibility: `window.render_game_to_text`, `window.advanceTime`, and `window.set_ship_svg_renderer` now forward to `window.Blasteroids`.
  - Rebuilt bundle via `npm run build`.
  - DevTools `file://` smoke validation passed with no console errors; both namespace and legacy APIs stepped simulation and returned valid text state.
- 2026-02-10 RF-10 pass (regression checks baseline):
  - Added `npm test` script (`node --test`) in `package.json`.
  - Added `test/util.test.js` for `src/util/math|vec2|angle|rng` baseline deterministic checks.
  - Added `test/engine.test.js` for deterministic timeline parity, arena config clamping, parseable `renderGameToText` payload shape, and `setShipSvgRenderer` behavior.
  - Test result: `8 passed, 0 failed` (`npm test`).
  - Updated docs to expose tests in `RUNBOOK.md` and `README.md`.
- 2026-02-10 RF-06/RF-07 refactor pass:
  - Extracted deterministic simulation into `src/engine/createEngine.js` (DOM-free engine surface with state init, update, resize, arena config, and debug/test helpers).
  - Extracted canvas drawing into `src/render/renderGame.js` as `createRenderer(engine)`, including ship SVG path caching on the renderer side (no engine mutation for render caches).
  - Updated `src/main.js` to browser composition glue that wires engine + renderer + existing DOM/input/menu/fullscreen/localStorage flows.
  - Preserved runtime hooks: `window.render_game_to_text`, `window.advanceTime`, and `window.set_ship_svg_renderer`.
  - Rebuilt bundle via `npm run build` to regenerate `dist/blasteroids.js`.
  - Smoke-tested under `file://` via DevTools: Start flow, no console errors, deterministic stepping (`advanceTime(1000)`), and thrust movement via scripted keydown/up + `advanceTime(500)`.
- 2026-02-10 RF-03 cleanup pass (index thinning, no behavior changes):
  - Removed remaining inline style attributes from `index.html` and replaced them with reusable CSS classes in `styles.css` (`accent-text`, `grid-tight`, `card-label`, `select-block`, `inline-split`, `inline-toggle`, `top-gap`, `stack-top`).
  - Kept all existing UI control IDs required by `src/ui/createUiBindings.js` intact.
  - Validation:
    - `npm test`: `9 passed, 0 failed`.
    - `npm run build` rebuilt committed runtime bundle `dist/blasteroids.js`.
    - DevTools `file://` smoke passed with no console errors:
      - start flow, movement (`W`), burst (`Space`), restart (`R`), fullscreen toggle (`F`),
      - debug menu toggle (`M`) and pause-on-open behavior (`movedWhileMenuOpen=0`, `movedWhileMenuClosed>0`),
      - both `window.Blasteroids.*` and legacy hook aliases callable and returning parseable state.
- 2026-02-10 RF-05 util extraction slice:
  - Added `src/util/collision.js` with `circleHit` and `circleCollide`.
  - Updated `src/engine/createEngine.js` to import collision helpers from `src/util/collision.js` and removed duplicate local implementations.
  - Extended `test/util.test.js` with baseline checks for collision helper behavior.
  - Validation:
    - `npm test`: `9 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - DevTools `file://` smoke recheck after build: no console errors; required controls/debug/hook checks remained green.
- 2026-02-10 RF-11 docs/reviewability pass:
  - Added architecture documentation: `docs/architecture.md` (runtime constraints, composition flow, module boundaries, build/runtime rules, testing expectations).
  - Added ownership reference: `docs/module-map.md` (file-to-responsibility map and dependency rules).
  - Added review checklist: `docs/review-checklist.md` (invariants, automated checks, `file://` smoke checks, boundary review, handoff steps).
  - Updated `README.md` with a new `Project Docs` section linking to the docs above.
  - Polished `RUNBOOK.md` smoke checklist to validate both namespace hooks (`window.Blasteroids.*`) and legacy aliases.
  - Updated refactor status in `repo-refactor-plan.md` to mark RF-11 as `DONE`.
  - Validation:
    - `npm test`: `9 passed, 0 failed`.
- 2026-02-10 RF-05 util extraction slice (asteroid helpers):
  - Added `src/util/asteroid.js` with shared asteroid size/rank/split and param-mapping helpers:
    - `asteroidSizeRank`, `asteroidNextSize`, `sizeSetHas`, `asteroidCanBreakTarget`
    - `asteroidRadiusForSize`, `asteroidMassForRadius`
    - `asteroidSpawnWeightForSize`, `asteroidDamageSpeedForSize`
  - Updated `src/engine/createEngine.js` to import and use the new asteroid util helpers, removing duplicate local implementations.
  - Extended `test/util.test.js` with asteroid util coverage.
  - Updated docs to reflect new utility module in architecture/module map and RF-05 status note.
  - Validation:
    - `npm test`: `10 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - DevTools `file://` smoke recheck: no console errors; start/move/burst/restart/fullscreen/debug pause behavior passed; both namespace and legacy hook surfaces callable.
- 2026-02-10 regression fix (ship visual growth restored):
  - Root cause: renderer hull drawing did not normalize polygon hull size to gameplay `ship.radius`, so tier transitions could appear nearly same-sized on screen.
  - Updated `src/render/renderGame.js`:
    - Added `polygonHullRadius(...)`.
    - In `drawShipModel(...)`, polygon renderer now scales hull/engine drawing to `ship.radius`.
    - SVG renderer keeps explicit `svgScale`, and now also supports optional `renderer.hullRadius` auto-normalization to `ship.radius` when provided.
  - Validation:
    - `npm test`: `10 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - DevTools `file://` check confirmed restored visual growth in-canvas:
      - small tier measured draw radius ~`14`
      - medium tier measured draw radius ~`29`
      - large tier measured draw radius ~`56`
- 2026-02-10 regression fixes (ship growth + mass/fracture tuning):
  - Increased medium tier hull radius and mass (`38`, `1920`) to amplify visible growth while keeping large at `56`.
  - Adjusted default tier zoom targets to `1.20` for medium/large to keep growth visible on screen.
  - Added `ship.radius` to `renderGameToText` payload for precise tier-size checks.
  - Reworked asteroid fracture logic to use mass-scaled speed requirements; size gate remains one size larger.
  - Scaled non-fracture impact shove by projectile/target mass ratio to reduce large-rock knockback from small hits.
  - Updated UI rules copy + README ship-size wording and ship-growth plan defaults to match new scaling/zoom.
  - Validation:
    - `npm test`: `10 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - DevTools `file://` smoke:
      - Start flow OK; movement + burst + restart OK.
      - Fullscreen hotkey attempted; blocked by browser gesture restrictions (no errors).
      - Debug menu toggle works; pause-on-open verified.
      - Hooks: `window.Blasteroids.renderGameToText/advanceTime` and legacy aliases callable without errors.
      - Tier size check via `renderGameToText` after zoom tween: small `radius=14`, `zoom=1.00` → screen radius `14.0`; medium `radius=38`, `zoom=1.20` → screen radius `45.6`; large `radius=56`, `zoom=1.20` → screen radius `67.2`.
- 2026-02-11 gameplay quirk pass (gems + small-impact breaks + camera defaults):
  - Gem drops from small-asteroid breaks now spawn stationary at the impact point (no inherited velocity and no jitter).
  - High-speed ambient small asteroids now self-break on impact with ship/other asteroids even when not ship-launched.
  - Kept ship-launched fracture permissions unchanged (size-gate logic unchanged).
  - Restored default growth zoom targets to zoom-out values in engine params (`tier2Zoom=0.78`, `tier3Zoom=0.58`).
  - Synced ship growth plan docs to match restored zoom defaults.
  - Validation (per request, no DevTools/Chrome launch in this pass):
    - `npm test`: `10 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 RF-05 completion pass (util extraction closure):
  - Added `src/util/ship.js` with shared `polygonHullRadius(...)`.
  - Updated `src/engine/createEngine.js` and `src/render/renderGame.js` to import `polygonHullRadius` from util instead of duplicating hull radius math.
  - Added `ship` util coverage in `test/util.test.js`.
  - Updated docs/module map and refactor tracker status for RF-05 completion.
  - Validation:
    - `npm test`: `11 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 tier-3 growth tuning pass (visual scale with camera unchanged):
  - Increased large-tier ship size to appear 2x larger than the prior result by doubling tier-3 hull radius (`56 -> 112`).
  - Scaled large-tier mass consistently with radius-area logic (`4160 -> 16640`).
  - Kept tier camera zoom-out defaults unchanged (`tier2Zoom=0.78`, `tier3Zoom=0.58`).
  - Synced docs for current hull-size defaults and growth scale notes.
  - Validation:
    - `npm test`: `11 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 SG-10/SG-11 closure pass (growth balancing knobs + telemetry + metadata coverage):
  - Added debug tuning knobs for ring feel: gravity softening, inner drag, ring pull (`ringK`), ring radial damping.
  - Added debug tuning knob for spawn pressure pacing: `asteroidSpawnRateScale` (scales time between population refill spawns).
  - Extended `renderGameToText` with population budget + spawn timer fields to support long-session tuning.
  - Added `test/debug-menu-metadata.test.js` to enforce that every interactive debug-menu control in `index.html` is represented in metadata.
  - Validation:
    - `npm test`: `12 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-12 exhaust particles MVP (deterministic ship thrusters):
  - Added deterministic `state.exhaust` particle system in `src/engine/createEngine.js`:
    - Spawns flame + occasional spark particles from per-ship engine nozzles while thrusting.
    - Particles persist in world space with TTL + velocity damping, creating visible trails + natural “flame lag” on turns.
  - Optimized exhaust sim to avoid per-frame allocations:
    - Added a small particle pool + in-place compaction to reduce GC thrash while thrusting.
    - Reduced spawn rate slightly for small tier and lengthened flame TTL a bit.
  - Switched exhaust rendering to cached radial-gradient sprite blits (round particles) to avoid per-particle path/shadow work.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - Playwright screenshot: `output/exhaust-particles-v3/shot-1.png`.
- 2026-02-12 debug tuning knobs for exhaust VFX:
  - Added params + debug menu sliders:
    - `exhaustIntensity` (scales emission + max particles).
    - `exhaustSparkScale` (scales spark emission).
    - `exhaustPalette`, `exhaustCoreScale`, `exhaustGlowScale` (controls inner/outer color/gradient via cached sprite regen).
    - `exhaustLegacyJets` toggle (disables the old orange jet overlay so palette changes are unambiguous).
  - Files: `src/engine/createEngine.js`, `src/ui/createUiBindings.js`, `index.html`.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` smoke (Chrome DevTools MCP): passed with no console errors:
      - Start flow; movement (W/A/D/S); burst (Space + click); restart (R); fullscreen (F).
      - Debug menu open/close (M + Escape) and pause-on-open verified (ship position stable while menu open).
      - Hooks verified: `window.Blasteroids.*` and legacy aliases callable; `renderGameToText()` returns parseable JSON.
- 2026-02-11 LA-13 completion pass (10x scale spawn tuning):
  - Capped asteroid population scaling so very large worlds don’t imply a quadratic asteroid count.
  - Population refills now prefer spawning near the camera (off-screen when possible) to keep local feel consistent at high world scales.
  - Validation:
    - `npm test`: `12 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` smoke (Chrome DevTools MCP): passed with no console errors:
      - Start; movement (W); burst (Space); restart (R); fullscreen (F).
      - Debug menu open/close (M + Escape) and pause-on-open verified (ship position stable while menu open while drifting).
      - Hooks verified: `window.Blasteroids.*` and legacy aliases callable; deterministic stepping works via `advanceTime(ms)`.
- 2026-02-11 UX + optional sound pass:
  - Game over overlay is now centered and includes explicit restart instructions (Press R / click).
  - Added optional simple SFX toggle in debug menu (WebAudio; default off; persisted via localStorage).
  - Validation:
    - `npm test`: `12 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` smoke (Chrome DevTools MCP): passed with no console errors (including toggling Sound).
- 2026-02-11 magnet/burst tuning pass:
  - Slightly reduced default magnet gravity (`gravityK`) and increased default burst speed (`burstSpeed`) for a bit more “fling” and less “vacuum”.
  - Fixed a `file://` console warning by deferring `AudioContext` creation until after a user gesture (no autoplay-policy warnings on load even when Sound is persisted ON).
  - Validation:
    - `npm test`: `12 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` smoke (Chrome DevTools MCP): passed with no console errors:
      - Start; movement (W); burst (Space); restart (R); debug menu toggle (M/Escape); hooks callable.
- 2026-02-11 arena defaults + fracture tuning pass:
  - Changed default arena scale to `10.00x` and default camera mode to `centered`.
  - Made large+ asteroids a bit more fracture-friendly by lowering the required fracture speed for large/xlarge/xxlarge targets.
  - Removed the experimental SFX toggle and wiring (we’ll revisit sound later).
  - Validation:
    - `npm test`: `12 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` smoke (Chrome DevTools MCP): passed with no console errors.

- 2026-02-11 FX pass: changed burst-launched asteroid visuals.
  - Electric tether (gravity pull) now *excludes* `shipLaunched` asteroids so burst throws don’t reuse the “pull” look.
  - Added a short-lived `launchFxT` timer on burst-launched asteroids and a new render pass that draws pink motion streaks + small shock arcs while that timer is active.
  - Rebuilt bundle (`npm run build`) and validated visually via Chrome DevTools MCP (canvas screenshot captured right after burst).
- 2026-02-11 FX tweak: burst FX color + semantics.
  - Replaced per-asteroid motion trails (looked like rocket exhaust) with a ring-emitted repulsion effect: yellow outward slashes + expanding arc segments outside the forcefield ring.
  - Visual validation via Chrome DevTools MCP screenshot right after a burst.
- 2026-02-11 FX tweak: burst "gravity waves".
  - Replaced burst slashes/streaks with concentric yellow arc wavefronts ( ))))) ) that radiate outward from just outside the forcefield ring and fade with distance.
  - Visual validation via Chrome DevTools MCP screenshot after burst.
- 2026-02-11 FX tweak: narrow per-rock wake waves.
  - Replaced wide ship-centered halo arcs with small wake arcs drawn just behind each burst-launched rock.
  - Reversed ombre: closest wave to the rock is brightest; subsequent waves fade out.
  - Added a simple "crowd" guard: if many rocks launch at once, reduce wave count and disable glow to keep it readable/cheap.
- 2026-02-11 FX tweak: wake waves visibility.
  - Increased launch FX TTL to 0.35s.
  - Made wake arcs much brighter/thicker and increased glow/blur so the ))))) trails are clearly visible.
- 2026-02-11 FX tweak: wake waves timing/shape + +25% alpha.
  - Flipped wave orientation and added a distance-based fade-in so waves don’t appear immediately at burst (avoids “shooting out of the asteroid”).
  - Reduced wave count a bit and toned brightness down; then bumped overall alpha by +25% per feedback.
- 2026-02-11 FX experiment: ring-surface wave trails.
  - Refactored burst “gravity waves” into a dedicated `effects` entity spawned at the forcefield surface (ring point) instead of being computed/rendered off each asteroid every frame.
  - Fixed direction mismatch: wavelets now orient along the *actual* launched asteroid velocity (accounts for ship velocity bias).
  - Wavelets are now stationary ripples just outside the ring (no longer moving with the rock), fading in only after the rock has clearly left the forcefield.
- 2026-02-11 render ordering fix: forcefield + trapped rocks on top.
  - Draw non-attached asteroids first, then the forcefield ring, then attached asteroids so trapped rocks/field always render in front of other asteroids.
  - Visual validation via Chrome DevTools MCP (forced overlap case).
- 2026-02-11 gravity pull FX + medium-size growth pass:
  - Increased medium-tier ship size and mass to strengthen true gameplay growth (`radius 57`, `mass 4320`), with large tier unchanged.
  - Expanded attraction pull-intensity generation beyond small-tier-only visuals: any attractable, non-launched asteroid now gets pull intensity (`pullFx`) when inside attract radius.
  - Updated pull-electricity rendering to scale tether count by asteroid size rank (independent of ship tier): `small=1`, `med=2`, `large=3`, `xlarge=4`, `xxlarge=5`.
  - Kept tier-specific ring/tether colors unchanged (amber/cyan/red).
  - Added deterministic tests:
    - medium tier pulls nearby `med` asteroids (`pullFx > 0`),
    - large tier pulls nearby `large` asteroids (`pullFx > 0`),
    - non-attractable target remains `pullFx = 0`,
    - size->tether count mapping assertions for small..xxlarge.
  - Validation:
    - `npm test`: `16 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
  - `file://` smoke (Chrome DevTools MCP): no console errors.
    - Verified runtime tier radii after override: medium `57` (zoom `0.78`), large `112` (zoom `0.58`).
    - Captured pull-FX screenshot with forced small/med/large pull cases: `/output/pullfx-lines-by-asteroid-size.png`.
- 2026-02-11 fracture tuning tweak (medium rocks):
  - Reduced medium-target fracture requirement slightly by adding a medium size multiplier in `fractureSpeedRequired` (`med: 1.00 -> 0.93`).
  - Kept large/xlarge/xxlarge fracture multipliers unchanged.
  - Validation:
    - `npm test`: `17 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 visual color tweak (attached medium rocks):
  - Updated attached asteroid color rule so attached `med` asteroids stay cyan/blue-green (`rgba(92,235,255,0.95)`) instead of switching to yellow.
  - Kept attached color for non-medium asteroids unchanged.
  - Validation:
    - `npm test`: `17 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 ring-color consistency + pull readability pass:
  - Attached asteroid color is now derived from current ship ring RGB (tier color), independent of asteroid size.
    - Medium-tier ring -> attached rocks cyan.
    - Large-tier ring -> attached rocks red.
  - Pull tether readability now scales by ship tier (thickness/brightness/wobble/spread increase on medium/large) to compensate for zoom-out.
  - Added render tests for:
    - ring-color-derived attached color,
    - tier-based pull visual scaling monotonicity.
  - Validation:
    - `npm test`: `19 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - `file://` visual checks captured:
      - `/output/attached-med-on-medium-tier.png` (cyan attached med on medium tier),
      - `/output/attached-med-on-large-tier.png` (red attached med on large tier).
- 2026-02-11 fracture tuning tweak (xlarge rocks):
  - Reduced xlarge-target fracture requirement by lowering size multiplier in `fractureSpeedRequired` (`xlarge: 0.90 -> 0.82`).
  - Kept medium/large/xxlarge multipliers unchanged in this pass.
  - Validation:
    - `npm test`: `19 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 fracture tuning tweak (medium rocks, stronger):
  - Further reduced medium-target fracture requirement by lowering medium size multiplier in `fractureSpeedRequired` (`med: 0.93 -> 0.75`).
  - Kept large/xlarge/xxlarge multipliers unchanged in this pass.
  - Validation:
    - `npm test`: `19 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 fracture tuning tweak (medium rocks, much easier):
  - Reduced medium-target fracture requirement again by lowering medium size multiplier in `fractureSpeedRequired` (`med: 0.75 -> 0.55`).
  - Validation:
    - `npm test`: `19 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 fracture + burst-force refactor pass (medium breakability):
  - Refactored fracture size multipliers into `fractureSizeMultiplier(targetSize)` for clearer tuning by target size.
  - Reduced medium-target fracture multiplier substantially (`med: 0.55 -> 0.35`) so medium rocks break much more easily.
  - Added tier-scaled burst launch force via `SHIP_TIERS.*.burstForceScale` and `currentBurstSpeed()`:
    - small `1.00x`, medium `1.38x`, large `1.85x`.
  - `burstAttached()` now uses `currentBurstSpeed()` so larger ships launch attached rocks with proportionally more force.
  - Added engine test `burst launch force scales up with ship tier` to prevent regressions.
  - Validation:
    - `npm test`: `20 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 medium-fracture bugfix pass (root-cause oriented):
  - Identified a gameplay bug: launched asteroids were still subject to forcefield attraction/capture logic, which could suppress projectile effectiveness and cause recapture before meaningful impacts.
  - Fixed projectile lifecycle:
    - `tryAttachAsteroid(...)` now rejects `shipLaunched` asteroids.
    - Attraction/ring-force application in `updateAsteroids(...)` now skips `shipLaunched` asteroids (launched rocks stay ballistic).
  - Refined fracture model for medium-target reliability:
    - Refactored size tuning into `fractureSizeMultiplier(targetSize)` and reduced medium target multiplier to `0.25`.
    - Added `fractureImpactSpeed(projectile, relativeSpeed)` and use it in projectile-vs-target fracture checks so co-moving impacts still carry launched momentum (`max(relativeSpeed, projectileSpeed*0.55)`).
  - Added/updated regression tests:
    - `burst launch force scales up with ship tier`.
    - `launched small can fracture co-moving medium target`.
  - Validation:
    - `npm test`: `21 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 medium-breakability diagnosis + fix follow-up:
  - Found additional gating issue: medium projectiles had a high damage-speed gate (`medDamageSpeedMin=360`) before fracture checks, making many practical medium impacts non-damaging.
  - Lowered medium damage-speed threshold to `240` so launched medium rocks count as damaging at realistic speeds.
  - Added regression test: `launched medium fractures medium target at moderate speed`.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - Playwright run: blocked (missing `playwright` package; install attempt did not complete).
- 2026-02-11 strong breakability tuning pass (medium + large targets):
  - Lowered projectile damage-speed gates:
    - `medDamageSpeedMin: 240 -> 160`
    - `largeDamageSpeedMin: 310 -> 190`
  - Lowered fracture size multipliers:
    - `med: 0.25 -> 0.18`
    - `large: 0.85 -> 0.58`
  - Increased carried-momentum contribution in fracture speed evaluation:
    - `fractureImpactSpeed`: `projectileSpeed * 0.55 -> * 0.75`
  - Added regression test: `launched medium fractures large target at moderate speed`.
  - Validation:
    - `npm test`: `23 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 asteroid fracture refactor (energy-based + ambient):
  - Replaced multi-gate fracture logic (shipLaunched + per-size damage-speed mins + size gate + mass-ratio speed) with a single impact-energy model:
    - `impactEnergy = 0.5 * reducedMass * v_rel^2`, multiplied by `projectileImpactScale` when ship-launched.
    - `fractureThreshold = 0.25 * targetMass * (fractureImpactSpeed * sizeBias)^2` with a small rank-based size bias (`+0.12` per size rank).
  - Ambient collisions can now fracture medium/large targets if energy is high enough.
  - Removed `asteroidCanBreakTarget` + `asteroidDamageSpeedForSize` helpers and all per-size damage-speed gates.
  - Ship-hit handling updated to use the same energy threshold for breaking launched rocks.
  - UI tuning: repurposed the “Damage speed (small)” slider to “Ship-launched impact boost” (now `projectileImpactScale`), updated helper text.
  - Tests updated for ambient fracture + projectile boost behavior.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 analysis pass (asteroid break logic deep dive + refactor plan):
  - Current break path has multiple gates: `shipLaunched` required for damaging impacts, per-size damage-speed mins, size-gate (`projectile can only break same size or one size larger`), and a separate fracture-speed requirement based on mass ratio + size multiplier.
  - Ambient (non-ship-launched) collisions only auto-break fast smalls; larger sizes never fracture from ambient collisions.
  - UI exposes only `smallDamageSpeedMin` + `fractureImpactSpeed`; medium/large damage-speed gates are code-only, which can make tuning feel ineffective.
  - Proposed simplification: unify damage/fracture into a single impact-energy model (`0.5 * reducedMass * v_rel^2`) with a per-target fracture threshold (scaled by mass/toughness) and an optional ship-launched multiplier, removing redundant gates. Add optional debug telemetry for impact energy/thresholds and migrate logic into a focused module.
- 2026-02-11 fracture impulse fix:
  - Apply `resolveElasticCollision(...)` even when fractures occur so surviving rocks receive a physical shove (momentum transfer) when the other object breaks.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-11 medium-break drop change:
  - Medium asteroid fractures now drop 2 stationary gems instead of spawning small asteroids (prevents immediate bounce-off chain).
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
    - Playwright run: blocked (missing `playwright` package).
- 2026-02-11 medium-break gem spacing:
  - Spawned the two medium-break gems on opposite sides of the impact axis so they don’t overlap.
  - Validation:
    - `npm test`: `22 passed, 0 failed`.
    - `npm run build`: success (`dist/blasteroids.js` regenerated).
- 2026-02-12 ship silhouette presets:
  - Added SVG-path ship presets + Playwright screenshot gallery under `assets/ships/` and `output/ship-gallery/`.
  - Set default tier silhouettes to:
    - small: needle
    - medium: hammer
    - large: bulwark
- 2026-02-12 ship thruster markers:
  - Replaced always-on red glow with neutral nozzle geometry markers so ship orientation is clear without implying thrust.
